# Name of your GitHub Actions workflow.
name: Publish to GitHub Pages

# Specifies to run this workflow whenever a push is made (commits are
# added) to the branch named `jekyll`.
on:
  push:
    branches:
      # Change this to the branch where you keep your Jekyll code.
      - jekyll

# Define a job named `build-and-publish` in your workflow.
jobs:
  build-and-publish:
    runs-on: ubuntu-latest # This job uses a GitHub-hosted runner.

    steps:
      # Checkout the source from the `jekyll` branch.
      - uses: actions/checkout@v2
      
      # Ruby / bundle setup
      - uses: ruby/setup-ruby@v1
        with: 
          ruby-version: 2.6
      - name: Install Gems
        run: |
          gem install bundler
          bundle install
        
      # Build
      - run: bundle exec jekyll build
        
      # Replace directory with _site
      - name: Replace directory with _site
        run: |
          find . ! \( -iregex '^./_site.*' -or -iregex '^./.git.*' \) -delete
          rsync -r _site/ .

      # Add, commit, and push
      - name: Add, commit, and push
        run: |
          git add .
          git commit -m "Built and deployed Jekyll"
          git push origin master
